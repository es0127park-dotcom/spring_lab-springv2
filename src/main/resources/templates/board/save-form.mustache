{{> header}}

<!-- jQuery (필수) -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Summernote CSS -->
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">

<!-- Summernote JS -->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>

<div class="container p-5">

    <div class="card">
        <div class="card-header"><b>게시글 작성</b></div>
        <div class="card-body">
            <form action="/boards/save" method="post" enctype="application/x-www-form-urlencoded">
                <div class="mb-3">
                    <input type="text" class="form-control" placeholder="Enter title" name="title">
                </div>
                <div class="mb-3">
                    <textarea id="content" class="form-control" rows="5" name="content"></textarea>
                </div>
                <button class="btn btn-secondary form-control">글쓰기</button>
            </form>
        </div>
    </div>
</div>
<script>
  // 1) 유튜브 URL에서 videoId만 뽑아내는 함수
  function extractYouTubeId(text) {
    if (!text) return null;

    const patterns = [
      /youtube\.com\/watch\?v=([^&\s]+)/,
      /youtu\.be\/([^?&\s]+)/,
      /youtube\.com\/shorts\/([^?&\s]+)/,
      /youtube\.com\/embed\/([^?&\s]+)/
    ];

    for (const p of patterns) {
      const m = text.match(p);
      if (m) return m[1];
    }
    return null;
  }

  // 2) videoId로 iframe HTML 만들기
  function makeYoutubeIframe(videoId) {
    return `
      <div class="video-wrap">
        <iframe
          width="560" height="315"
          src="https://www.youtube.com/embed/${videoId}"
          title="YouTube video player"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          allowfullscreen>
        </iframe>
      </div>
    `;
  }

  $(document).ready(function () {
    $('#content').summernote({
      height: 300,
      placeholder: '내용을 입력하세요',

      callbacks: {
        onPaste: function (e) {
          const clipboard = (e.originalEvent || e).clipboardData;
          if (!clipboard) return;

          const text = clipboard.getData('text/plain');
          const videoId = extractYouTubeId(text);

          if (videoId) {
            e.preventDefault(); // 기본 paste 막기
            $('#content').summernote('pasteHTML', makeYoutubeIframe(videoId));
          }
        }
      }
    });
  });
</script>
</body>
</html>